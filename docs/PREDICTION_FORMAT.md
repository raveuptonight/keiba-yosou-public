# äºˆæƒ³ãƒ‡ãƒ¼ã‚¿æ§‹é€ ä»•æ§˜

## æ¦‚è¦

LLMãŒç”Ÿæˆã™ã‚‹äºˆæƒ³çµæœã¨ã€Discord Botã§è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å®šç¾©ã—ã¾ã™ã€‚

---

## äºˆæƒ³çµæœJSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### å®Œå…¨ãªæ§‹é€ ä¾‹

```json
{
  "race_id": "202412280506",
  "race_name": "ä¸­å±±é‡‘æ¯",
  "race_date": "2024-12-28",
  "venue": "ä¸­å±±",
  "race_number": "11R",
  "race_time": "15:25",
  "prediction_result": {
    "win_prediction": {
      "first": {
        "horse_number": 3,
        "horse_name": "ãƒ‡ã‚£ãƒ¼ãƒ—ãƒœãƒ³ãƒ‰",
        "expected_odds": 3.5,
        "confidence": 0.85
      },
      "second": {
        "horse_number": 7,
        "horse_name": "ã‚¨ãƒ•ãƒ•ã‚©ãƒ¼ãƒªã‚¢",
        "expected_odds": 5.2,
        "confidence": 0.72
      },
      "third": {
        "horse_number": 12,
        "horse_name": "ã‚¿ã‚¤ãƒˆãƒ«ãƒ›ãƒ«ãƒ€ãƒ¼",
        "expected_odds": 8.1,
        "confidence": 0.65
      },
      "fourth": {
        "horse_number": 5,
        "horse_name": "ãƒ‘ãƒ³ã‚µãƒ©ãƒƒã‚µ",
        "expected_odds": 12.0,
        "confidence": 0.58
      },
      "fifth": {
        "horse_number": 9,
        "horse_name": "ã‚¤ã‚¯ã‚¤ãƒãƒƒã‚¯ã‚¹",
        "expected_odds": 15.0,
        "confidence": 0.52
      },
      "excluded": [
        {
          "horse_number": 1,
          "horse_name": "ãƒ€ãƒ¡ã‚¦ãƒ",
          "reason": "èª¿æ•™æ™‚è¨ˆä¸è‰¯"
        },
        {
          "horse_number": 14,
          "horse_name": "ã‚­ã‚±ãƒ³ã‚¦ãƒ",
          "reason": "å‰èµ°å¤§æ•—"
        },
        {
          "horse_number": 16,
          "horse_name": "ã‚¯ãƒ©ã‚¤ã‚¦ãƒ",
          "reason": "æ é †ä¸åˆ©"
        }
      ]
    },
    "betting_strategy": {
      "recommended_tickets": [
        {
          "ticket_type": "3é€£è¤‡",
          "numbers": [3, 7, 12],
          "amount": 1000,
          "expected_payout": 8500
        },
        {
          "ticket_type": "é¦¬é€£",
          "numbers": [3, 7],
          "amount": 500,
          "expected_payout": 2800
        },
        {
          "ticket_type": "å˜å‹",
          "numbers": [3],
          "amount": 300,
          "expected_payout": 1050
        }
      ]
    }
  },
  "total_investment": 10000,
  "expected_return": 15000,
  "expected_roi": 1.5,
  "predicted_at": "2024-12-28T09:00:00+09:00",
  "is_final": false
}
```

---

## ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è©³ç´°

### ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|-----|------|
| `race_id` | string | âœ… | ãƒ¬ãƒ¼ã‚¹IDï¼ˆ12æ¡ï¼‰ |
| `race_name` | string | âœ… | ãƒ¬ãƒ¼ã‚¹å |
| `race_date` | string | âœ… | ãƒ¬ãƒ¼ã‚¹æ—¥ï¼ˆISO 8601å½¢å¼ï¼‰ |
| `venue` | string | âœ… | ç«¶é¦¬å ´å |
| `race_number` | string | âœ… | ãƒ¬ãƒ¼ã‚¹ç•ªå·ï¼ˆä¾‹: "11R"ï¼‰ |
| `race_time` | string | âœ… | ç™ºèµ°æ™‚åˆ»ï¼ˆä¾‹: "15:25"ï¼‰ |
| `prediction_result` | object | âœ… | äºˆæƒ³çµæœæœ¬ä½“ |
| `total_investment` | integer | âœ… | ç·æŠ•è³‡é¡ï¼ˆå††ï¼‰ |
| `expected_return` | integer | âœ… | æœŸå¾…å›åé¡ï¼ˆå††ï¼‰ |
| `expected_roi` | float | âœ… | æœŸå¾…ROIï¼ˆå€ç‡ï¼‰ |
| `predicted_at` | string | âœ… | äºˆæƒ³å®Ÿè¡Œæ—¥æ™‚ |
| `is_final` | boolean | âœ… | æœ€çµ‚äºˆæƒ³ï¼ˆé¦¬ä½“é‡å¾Œï¼‰ãƒ•ãƒ©ã‚° |

### prediction_result.win_prediction

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|-----|------|
| `first` | object | âœ… | â—æœ¬å‘½ |
| `second` | object | âœ… | â—‹å¯¾æŠ— |
| `third` | object | âœ… | â–²å˜ç©´ |
| `fourth` | object | â­• | â–³é€£ä¸‹ |
| `fifth` | object | â­• | â˜†æ³¨ç›®é¦¬ |
| `excluded` | array | â­• | âœ•æ¶ˆã—é¦¬ãƒªã‚¹ãƒˆ |

### é¦¬æƒ…å ±ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆfirst, second, third, fourth, fifthï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|-----|------|
| `horse_number` | integer | âœ… | é¦¬ç•ª |
| `horse_name` | string | âœ… | é¦¬å |
| `expected_odds` | float | â­• | äºˆæƒ³ã‚ªãƒƒã‚º |
| `confidence` | float | â­• | ä¿¡é ¼åº¦ï¼ˆ0.0ã€œ1.0ï¼‰ |

### æ¶ˆã—é¦¬ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆexcludedé…åˆ—ã®è¦ç´ ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|-----|------|
| `horse_number` | integer | âœ… | é¦¬ç•ª |
| `horse_name` | string | âœ… | é¦¬å |
| `reason` | string | â­• | æ¶ˆã™ç†ç”± |

### prediction_result.betting_strategy

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|-----|------|
| `recommended_tickets` | array | âœ… | æ¨å¥¨é¦¬åˆ¸ãƒªã‚¹ãƒˆ |

### æ¨å¥¨é¦¬åˆ¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|-----|------|
| `ticket_type` | string | âœ… | é¦¬åˆ¸ã‚¿ã‚¤ãƒ—ï¼ˆå˜å‹ã€é¦¬é€£ã€3é€£è¤‡ç­‰ï¼‰ |
| `numbers` | array | âœ… | é¦¬ç•ªãƒªã‚¹ãƒˆ |
| `amount` | integer | âœ… | è³¼å…¥é‡‘é¡ï¼ˆå††ï¼‰ |
| `expected_payout` | integer | â­• | æœŸå¾…æ‰•æˆ»é¡ï¼ˆå††ï¼‰ |

---

## Discordå‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

ä¸Šè¨˜JSONãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§Discordã«é€šçŸ¥ã•ã‚Œã¾ã™ï¼š

```
ğŸ‡ ã€äºˆæƒ³å®Œäº†ã€‘ä¸­å±±é‡‘æ¯

ğŸ“… 2024/12/28 (æ—¥) 15:25 ä¸­å±±11R

â—æœ¬å‘½: 3ç•ª ãƒ‡ã‚£ãƒ¼ãƒ—ãƒœãƒ³ãƒ‰
â—‹å¯¾æŠ—: 7ç•ª ã‚¨ãƒ•ãƒ•ã‚©ãƒ¼ãƒªã‚¢
â–²å˜ç©´: 12ç•ª ã‚¿ã‚¤ãƒˆãƒ«ãƒ›ãƒ«ãƒ€ãƒ¼
â–³é€£ä¸‹: 5ç•ª ãƒ‘ãƒ³ã‚µãƒ©ãƒƒã‚µ
â˜†æ³¨ç›®: 9ç•ª ã‚¤ã‚¯ã‚¤ãƒãƒƒã‚¯ã‚¹

âœ•æ¶ˆã—é¦¬: 1ç•ªãƒ€ãƒ¡ã‚¦ãƒ, 14ç•ªã‚­ã‚±ãƒ³ã‚¦ãƒ, 16ç•ªã‚¯ãƒ©ã‚¤ã‚¦ãƒ

ğŸ’° æ¨å¥¨é¦¬åˆ¸
ãƒ»3é€£è¤‡ [3-7-12] 1,000å††
ãƒ»é¦¬é€£ [3-7] 500å††
ãƒ»å˜å‹ [3] 300å††

æŠ•è³‡é¡: 10,000å††
æœŸå¾…å›å: 15,000å††
æœŸå¾…ROI: 150.0%

ğŸ“Š è©³ç´°: http://localhost:8000/predictions/abc123
```

---

## äºˆæƒ³å°ã®æ„å‘³

| å° | åç§° | æ„å‘³ | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
|----|------|------|-----------|
| â— | æœ¬å‘½ | æœ€ã‚‚ä¿¡é ¼ã§ãã‚‹1ç€å€™è£œ | `first` |
| â—‹ | å¯¾æŠ— | æœ¬å‘½ã«æ¬¡ãæœ‰åŠ›é¦¬ | `second` |
| â–² | å˜ç©´ | ç©´é¦¬å€™è£œï¼ˆé«˜é…å½“æœŸå¾…ï¼‰ | `third` |
| â–³ | é€£ä¸‹ | é€£å¯¾ãƒ»3ç€å€™è£œ | `fourth` |
| â˜† | æ³¨ç›® | æ³¨ç›®é¦¬ãƒ»ä¼å…µ | `fifth` |
| âœ• | æ¶ˆã— | è©•ä¾¡ãŒä½ã„ãƒ»è²·ã‚ãªã„é¦¬ | `excluded` |

---

## LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆã¸ã®å½±éŸ¿

LLMã«äºˆæƒ³ã‚’ç”Ÿæˆã•ã›ã‚‹éš›ã€ä»¥ä¸‹ã®JSONæ§‹é€ ã§å‡ºåŠ›ã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã—ã¾ã™ï¼š

```python
prompt = """
ä»¥ä¸‹ã®JSONå½¢å¼ã§äºˆæƒ³ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

{
  "win_prediction": {
    "first": {"horse_number": X, "horse_name": "é¦¬å", "expected_odds": X.X, "confidence": 0.XX},
    "second": {...},
    "third": {...},
    "fourth": {...},
    "fifth": {...},
    "excluded": [
      {"horse_number": X, "horse_name": "é¦¬å", "reason": "ç†ç”±"}
    ]
  },
  "betting_strategy": {
    "recommended_tickets": [...]
  }
}

æ³¨æ„:
- first, second, thirdã¯å¿…é ˆ
- fourth, fifthã¯ä»»æ„ï¼ˆæœ‰åŠ›é¦¬ãŒå¤šã„å ´åˆã®ã¿ï¼‰
- excludedã¯æœ€å¤§3é ­ã¾ã§ï¼ˆè©•ä¾¡ãŒè‘—ã—ãä½ã„é¦¬ã®ã¿ï¼‰
"""
```

---

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### å¿…é ˆãƒã‚§ãƒƒã‚¯

1. `first`, `second`, `third`ã¯å¿…ãšå­˜åœ¨
2. å„é¦¬ã®`horse_number`ã¨`horse_name`ã¯å¿…é ˆ
3. `horse_number`ã¯1ã€œ18ã®ç¯„å›²
4. åŒã˜é¦¬ç•ªãŒè¤‡æ•°å›å‡ºç¾ã—ãªã„ã“ã¨

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯

1. `expected_odds`ã¯æ­£ã®æ•°å€¤
2. `confidence`ã¯0.0ã€œ1.0ã®ç¯„å›²
3. `excluded`é…åˆ—ã®è¦ç´ æ•°ã¯0ã€œ3

---

## å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: `src/discord/formatters.py:15-114`
- **ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼**: ï¼ˆTODO: ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼å®Ÿè£…äºˆå®šï¼‰
- **LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: `prompts/prediction_prompt.py`ï¼ˆTODOï¼‰

---

## å¤‰æ›´å±¥æ­´

- 2024-12-28: â–³é€£ä¸‹ã€â˜†æ³¨ç›®é¦¬ã€âœ•æ¶ˆã—é¦¬ã‚’è¿½åŠ 
- 2024-12-27: åˆç‰ˆä½œæˆ
